<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPE Calendar</title>
    <meta name="description" content="Sync your CPE calendar with your personal one">
    <meta name="keywords" content="calendar, ics, CPE, apple, google">
    <meta name="author" content="https://github.com/loan-mgt">
    <meta property="og:title" content="CPE Calendar">
    <meta property="og:description" content="Sync your CPE calendar with your personal one">
    <meta property="og:image" content="/static/banner.png">
    <meta property="og:url" content="https://cpe-cal.for-loop.fr">
    <meta property="og:type" content="website">
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">

    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="core">
        <header>
            <h1>CPE Calendar</h1>
        </header>
        <main>
            <div id="calendar">
                <h2>The best way to stay up-to-date with your schedule using your personal calendar app.</h2>
                <a href="#available">Let's get started</a>
            </div>
        </main>
    </div>

    <div class="list">
        <div class="center">
            <h2 id="available">Get your calendars</h2>
        </div>
        <ul>
            <li>
                <label>Enter your CPE credentials to generate a calendar</label>
                <div>
                    <input type="text" id="username" placeholder="Email" />
                    <input type="password" id="password" placeholder="Password" />
                </div>
                <button onclick="generateEncryptedLink()">Generate Calendar Link</button>
            </li>
        </ul>
    </div>

    <div id="toast">Link copied to clipboard!</div>

    <script>
        const pemEncodedKey = `{{.PublicKey}}`;
        const separator = `{{.Separator}}`;

        async function generateEncryptedLink() {
            try {
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                if (!username || !password) {
                    alert("Please enter both username and password.");
                    return;
                }

                const encryptedCreds = await encryptMessage(`${username}${separator}${password}`);
                if (!encryptedCreds) throw new Error('Encryption failed');

                const url = `/your-cpe-calendar.ics?creds=${encodeURIComponent(encryptedCreds)}`;
                copyLink(url);
            } catch (error) {
                console.error('Error generating encrypted link:', error);
            }
        }

    </script>
    <script src="/static/encryption.js"></script> 
</body>

</html>
